

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pybob.GeoImg &mdash; pybob  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> pybob
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules/index.html">modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../scripts/index.html">scripts</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pybob</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pybob.GeoImg</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pybob.GeoImg</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">pybob.GeoImg is a class to handle geospatial imagery, in particular satellite images and digital elevation models.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="k">import</span> <span class="n">print_function</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">datetime</span> <span class="k">as</span> <span class="nn">dt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span><span class="p">,</span> <span class="n">osr</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.axes_grid1</span> <span class="k">import</span> <span class="n">make_axes_locatable</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="k">import</span> <span class="n">griddata</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="k">import</span> <span class="n">ConvexHull</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="k">import</span> <span class="n">Pool</span>

<span class="n">numpy2gdal</span> <span class="o">=</span> <span class="p">{</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_UInt16</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int16</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">,</span>
              <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float64</span><span class="p">,</span> 
              <span class="n">np</span><span class="o">.</span><span class="n">uint32</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_UInt32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Int32</span><span class="p">,</span> 
              <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">:</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_CFloat64</span><span class="p">}</span>

<span class="n">lsat_sensor</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="s1">&#39;OLI/TIRS&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="s1">&#39;ETM+&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">:</span> <span class="s1">&#39;TM&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="s1">&#39;MSS&#39;</span><span class="p">,</span> <span class="s1">&#39;O&#39;</span><span class="p">:</span> <span class="s1">&#39;OLI&#39;</span><span class="p">,</span> <span class="s1">&#39;TI&#39;</span><span class="p">:</span> <span class="s1">&#39;TIRS&#39;</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">parse_landsat</span><span class="p">(</span><span class="n">gname</span><span class="p">):</span>
    <span class="n">attrs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lsat_sensor</span><span class="p">[</span><span class="n">gname</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Landsat </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">gname</span><span class="p">[</span><span class="mi">2</span><span class="p">])))</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">gname</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">gname</span><span class="p">[</span><span class="mi">6</span><span class="p">:</span><span class="mi">9</span><span class="p">])))</span>
        <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gname</span><span class="p">[</span><span class="mi">9</span><span class="p">:</span><span class="mi">13</span><span class="p">])</span>
        <span class="n">doy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">gname</span><span class="p">[</span><span class="mi">13</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">fromordinal</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">date</span><span class="p">(</span><span class="n">year</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span><span class="o">.</span><span class="n">toordinal</span><span class="p">()</span><span class="o">+</span><span class="n">doy</span><span class="p">))</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
    <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;L[COTEM][0-9]</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">split_name</span> <span class="o">=</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lsat_sensor</span><span class="p">[</span><span class="n">split_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Landsat </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">split_name</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">])))</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">int</span><span class="p">(</span><span class="n">split_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]),</span> <span class="nb">int</span><span class="p">(</span><span class="n">split_name</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">:</span><span class="mi">6</span><span class="p">])))</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">split_name</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">))</span>
        <span class="n">attrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">attrs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">date</span><span class="p">())</span>
    <span class="k">return</span> <span class="n">attrs</span>


<span class="k">def</span> <span class="nf">get_file_info</span><span class="p">(</span><span class="n">in_filestring</span><span class="p">):</span>
    <span class="n">in_filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">in_filestring</span><span class="p">)</span>
    <span class="n">in_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">in_filestring</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">in_dir</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
        <span class="n">in_dir</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
    <span class="k">return</span> <span class="n">in_filename</span><span class="p">,</span> <span class="n">in_dir</span>

<span class="k">def</span> <span class="nf">int_pts</span><span class="p">(</span><span class="n">myins</span><span class="p">):</span>
    <span class="n">pt</span><span class="p">,</span> <span class="n">ij</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">myins</span>            
    <span class="k">try</span><span class="p">:</span>
        <span class="n">zint</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">pt</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">zint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">return</span> <span class="n">zint</span>
<span class="c1">#    return griddata((myins[2].flatten(), myins[3].flatten()), myins[4].flatten(), myins[0], method=myins[5])</span>


<div class="viewcode-block" id="GeoImg"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg">[docs]</a><span class="k">class</span> <span class="nc">GeoImg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create a GeoImg object from a GDAL-supported raster dataset.</span>
<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="GeoImg.__init__"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">in_filename</span><span class="p">,</span> <span class="n">in_dir</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datestr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;%m/</span><span class="si">%d</span><span class="s1">/%y&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param in_filename:  Filename or object to read in. If in_filename is a string, the GeoImg is created by reading the file</span>
<span class="sd">            corresponding to that filename. If in_filename is a gdal object, the</span>
<span class="sd">            GeoImg is created by operating on the corresponding object.</span>
<span class="sd">        :param in_dir: (optional) directory where in_filename is located. If not given, the directory</span>
<span class="sd">            will be determined from the input filename.</span>
<span class="sd">        :param datestr: (optional) string to pass to GeoImg, representing the date the image was acquired.</span>
<span class="sd">        :param datefmt: Format of datestr that datetime.datetime should use to parse datestr.</span>
<span class="sd">            Default is %m/%d/%y.</span>
<span class="sd">        :param dtype: numpy datatype to read input data as. Default is np.float32. See numpy docs for more details.</span>

<span class="sd">        :type in_filename: str, gdal.Dataset</span>
<span class="sd">        :type in_dir: str</span>
<span class="sd">        :type datestr: str</span>
<span class="sd">        :type dtype: numpy datatype</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">in_filename</span><span class="p">)</span> <span class="ow">is</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Dataset</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_dir_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_dir_abs_path</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gd</span> <span class="o">=</span> <span class="n">in_filename</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">in_filename</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">in_dir</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">in_filename</span><span class="p">,</span> <span class="n">in_dir</span> <span class="o">=</span> <span class="n">get_file_info</span><span class="p">(</span><span class="n">in_filename</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="n">in_filename</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_dir_path</span> <span class="o">=</span> <span class="n">in_dir</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">in_dir_abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">in_dir</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gd</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dir_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;in_filename must be a string or a gdal Dataset&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsg</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">isdigit</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
        <span class="n">dump</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spatialReference</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">)</span>  <span class="c1"># do this to make our SRS nice and easy for osr later.</span>
        <span class="k">del</span> <span class="n">dump</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">intype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetDriver</span><span class="p">()</span><span class="o">.</span><span class="n">ShortName</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">RasterXSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">RasterYSize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">GetNoDataValue</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">dtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetMetadataItem</span><span class="p">(</span><span class="s1">&#39;AREA_OR_POINT&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complex64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isfloat</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">isfloat</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">isfloat</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match_sensor</span><span class="p">(</span><span class="n">in_filename</span><span class="p">,</span> <span class="n">datestr</span><span class="o">=</span><span class="n">datestr</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="n">datefmt</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">attrs</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">sensor_name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">satellite</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">tile</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">datetime</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">attrs</span><span class="o">.</span><span class="n">date</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">img_ov2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_ov10</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">10</span><span class="p">]</span></div>

<div class="viewcode-block" id="GeoImg.match_sensor"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.match_sensor">[docs]</a>    <span class="k">def</span> <span class="nf">match_sensor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fname</span><span class="p">,</span> <span class="n">datestr</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datefmt</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Attempts to pull metadata (e.g., sensor, date information) from fname, setting sensor_name, satellite,</span>
<span class="sd">        tile, datetime, and date attributes of GeoImg object.</span>

<span class="sd">        :param fname: filename of image to parse</span>
<span class="sd">        :param datestr: optional datestring to set date attributes</span>
<span class="sd">        :param datefmt: optional datetime format for datestr</span>
<span class="sd">        :type fname: str</span>
<span class="sd">        :type datestr: str</span>
<span class="sd">        :type datefmt: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">fname</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># assumes that the filename has a form GRANULE_BXX.ext</span>
        <span class="k">if</span> <span class="s1">&#39;_&#39;</span> <span class="ow">in</span> <span class="n">bname</span><span class="p">:</span>
            <span class="n">gname</span> <span class="o">=</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1">#print(&quot;I don&#39;t recognize this filename format.&quot;)</span>
            <span class="c1">#print(&quot;Make sure to specify a date and format if you need date info,&quot;)</span>
            <span class="c1">#print(&quot;  and your filename is not a standard filename.&quot;)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No date information read from filename.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># first, check if we&#39;ve been given a date</span>
        <span class="k">elif</span> <span class="n">datestr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">datestr</span><span class="p">,</span> <span class="n">datefmt</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;L[COTEM][0-9]</span><span class="si">{2}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">parse_landsat</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;L&#39;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="n">parse_landsat</span><span class="p">(</span><span class="n">gname</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="n">attrs</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="c1"># next, sentinel 2</span>
        <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s1">&#39;T[0-9]</span><span class="si">{2}</span><span class="s1">[A-Z]</span><span class="si">{3}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="c1"># sentinel 2 tiles have form</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="s1">&#39;MSI&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="s1">&#39;Sentinel-2&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">T%H%M%S&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="c1"># next, aster</span>
        <span class="k">elif</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;AST&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="s1">&#39;ASTER&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="s1">&#39;Terra&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">][</span><span class="mi">3</span><span class="p">:],</span> <span class="s1">&#39;%m</span><span class="si">%d</span><span class="s1">%Y%H%M%S&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;SETSM&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="s1">&#39;SETSM&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">elif</span> <span class="n">gname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span> <span class="s1">&#39;SPOT&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="s1">&#39;HFS&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="s1">&#39;SPOT5&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="n">dt</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">bname</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># print(&quot;No date information read from filename.&quot;)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sensor_name</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">satellite</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tile</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datetime</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">date</span> <span class="o">=</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="GeoImg.info"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Prints information about the GeoImg (filename, coordinate system, number of columns/rows, etc.).&quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Driver:             </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetDriver</span><span class="p">()</span><span class="o">.</span><span class="n">LongName</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">intype</span> <span class="o">!=</span> <span class="s1">&#39;MEM&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File:               </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">in_dir_path</span> <span class="o">+</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File:               </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s1">&#39;in memory&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Size:               </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Coordinate System:  EPSG:</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsg</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NoData Value:       </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pixel Size:         </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Upper Left Corner:  </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Lower Right Corner: </span><span class="si">{}</span><span class="s1">, </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[MAXIMUM]:          </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[MINIMUM]:          </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)))</span></div>
        <span class="c1"># print(&#39;[MEAN]:             {}&#39;.format(np.nanmean(self.img)))</span>
        <span class="c1"># print(&#39;[MEDIAN]:           {}&#39;.format(np.nanmedian(self.img)))</span>

<div class="viewcode-block" id="GeoImg.display"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.display">[docs]</a>    <span class="k">def</span> <span class="nf">display</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sfact</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showfig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display GeoImg in a matplotlib figure.</span>

<span class="sd">        :param fig: figure handle to show image in. If not set, creates a new figure.</span>
<span class="sd">        :param cmap: colormap to use for the image. Default is gray.</span>
<span class="sd">        :param extent: spatial extent to limit the figure to, given as xmin, xmax, ymin, ymax.</span>
<span class="sd">        :param sfact: Factor by which to reduce the number of pixels plotted.</span>
<span class="sd">            Default is 1 (i.e., all pixels are displayed).</span>
<span class="sd">        :param showfig: Open the figure window. Default is True.</span>
<span class="sd">        :param band: Image bands to use, if GeoImg represents a multi-band image.</span>
<span class="sd">        :param kwargs: Optional keyword arguments to pass to matplotlib.pyplot.imshow</span>
<span class="sd">        :type fig: matplotlib.figure.Figure</span>
<span class="sd">        :type cmap: matplotlib colormap</span>
<span class="sd">        :type extent: array-like</span>
<span class="sd">        :type sfact: int</span>
<span class="sd">        :type showfig: bool</span>
<span class="sd">        :type band: array-like</span>
<span class="sd">        :returns fig: Handle pointing to the matplotlib Figure created (or passed to display).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="c1"># fig.hold(True)</span>
        <span class="c1"># else:</span>
            <span class="c1"># fig.hold(True)</span>

        <span class="k">if</span> <span class="n">extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">extent</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">]</span>
            <span class="n">disp_ext</span> <span class="o">=</span> <span class="n">extent</span>
            <span class="n">mini</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxi</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span>
            <span class="n">minj</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="n">maxj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extent</span>
            <span class="n">mini</span><span class="p">,</span> <span class="n">minj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2ij</span><span class="p">((</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">))</span>
            <span class="n">maxi</span><span class="p">,</span> <span class="n">maxj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2ij</span><span class="p">((</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">))</span>
                       
            <span class="n">mini</span> <span class="o">+=</span> <span class="mf">0.5</span>
            <span class="n">minj</span> <span class="o">+=</span> <span class="mf">0.5</span>

            <span class="n">maxi</span> <span class="o">-=</span> <span class="mf">0.5</span>
            <span class="n">maxj</span> <span class="o">-=</span> <span class="mf">0.5</span>  <span class="c1"># subtract the .5 for half a pixel, add 1 for slice</span>

            <span class="n">mini</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mini</span><span class="p">)</span>
            <span class="n">maxi</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">maxi</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span><span class="p">)</span>

            <span class="n">minj</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">minj</span><span class="p">)</span>
            <span class="n">maxj</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">maxj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span><span class="p">)</span>
            <span class="n">disp_ext</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)]</span>
            
        <span class="c1"># if we only have one band, plot it.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">RasterCount</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sfact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">showimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">showimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">showimg</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">disp_ext</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">band</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">int</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">sfact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">showimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">showimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">]</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">showimg</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">disp_ext</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># if we have more than one band and we&#39;ve asked to display them all, do it.</span>
            <span class="k">if</span> <span class="n">sfact</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
                <span class="n">b3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">)]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">b1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">]</span>
                <span class="n">b2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">]</span>
                <span class="n">b3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">band</span><span class="p">[</span><span class="mi">2</span><span class="p">]][</span><span class="nb">int</span><span class="p">(</span><span class="n">mini</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxi</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">minj</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">maxj</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span><span class="n">sfact</span><span class="p">]</span>
            <span class="n">rgb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">([</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">])</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">rgb</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">disp_ext</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">extent</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">extent</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># get current axes</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s1">&#39;equal&#39;</span><span class="p">)</span>    <span class="c1"># set equal aspect</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">(</span><span class="n">tight</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># set axes tight</span>

        <span class="k">if</span> <span class="n">showfig</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>  <span class="c1"># don&#39;t forget this one!</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="GeoImg.write"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outfilename</span><span class="p">,</span> <span class="n">out_folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bands</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write GeoImg to a gdal-supported raster file.</span>
<span class="sd">        </span>
<span class="sd">        :param outfilename: string representing the filename to be written to.</span>
<span class="sd">        :param out_folder: optional string representing the folder to be written to. If not set,</span>
<span class="sd">            folder is either guessed from outfilename, or assumed to be the current folder.</span>
<span class="sd">        :param driver: optional string representing the gdal driver to use to write the raster file. Default is GTiff.</span>
<span class="sd">            Options include: HDF4, HDF5, JPEG, PNG, JPEG2000 (if enabled). See gdal docs for more options.</span>
<span class="sd">        :param datatype: Type of data to write the raster as. Check GeoImg.numpy2gdal.keys() to see numpy data types implemented.</span>
<span class="sd">        :param bands: Specify band(s) to write to file. Default behavior is all bands.</span>
<span class="sd">        :type outfilename: str</span>
<span class="sd">        :type out_folder: str</span>
<span class="sd">        :type driver: str</span>
<span class="sd">        :type datatype: numpy datatype</span>
<span class="sd">        :type bands: array-like</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dtype</span>
        <span class="c1"># if we don&#39;t specify which bands, we&#39;re going to write all of them</span>
        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">nband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">RasterCount</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nband</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">bands</span><span class="p">)</span>
        
        <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>

        <span class="n">ncols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span>

        <span class="k">if</span> <span class="n">out_folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">outfilename</span><span class="p">,</span> <span class="n">out_folder</span> <span class="o">=</span> <span class="n">get_file_info</span><span class="p">(</span><span class="n">outfilename</span><span class="p">)</span>
            
        <span class="n">out</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">out_folder</span><span class="p">,</span> <span class="n">outfilename</span><span class="p">]),</span> <span class="n">ncols</span><span class="p">,</span> <span class="n">nrows</span><span class="p">,</span> <span class="n">nband</span><span class="p">,</span> <span class="n">numpy2gdal</span><span class="p">[</span><span class="n">dtype</span><span class="p">])</span>

        <span class="n">setgeo</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
        <span class="n">setproj</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
        <span class="n">nanmask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">nanmask</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">nanmask</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="o">=</span> <span class="o">-</span><span class="mi">9999</span>

        <span class="k">if</span> <span class="n">bands</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nband</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">write</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nband</span><span class="p">):</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">nband</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">write</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">bands</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:,</span> <span class="p">:])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">bands</span><span class="p">):</span>
                    <span class="n">write</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="n">out</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>

        <span class="n">out</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">nanmask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

        <span class="k">del</span> <span class="n">setgeo</span><span class="p">,</span> <span class="n">setproj</span><span class="p">,</span> <span class="n">write</span></div>

<div class="viewcode-block" id="GeoImg.copy"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_raster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">new_extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;MEM&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
             <span class="n">newproj</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Copy the GeoImg, creating a new GeoImg, optionally updating the extent and raster.</span>

<span class="sd">        :param new_raster: New raster to use. If not set, the new GeoImg will have the same raster</span>
<span class="sd">            as the old image.</span>
<span class="sd">        :param new_extent: New extent to use, given as xmin, xmax, ymin, ymax. If not set,</span>
<span class="sd">            the old extent is used. If set, you must also include a new raster.</span>
<span class="sd">        :param driver: gdal driver to use to create the new GeoImg. Default is &#39;MEM&#39; (in-memory).</span>
<span class="sd">            See gdal docs for more options. If a different driver is used, filename must</span>
<span class="sd">            also be specified.</span>
<span class="sd">        :param filename: Filename corresponding to the new image, if not created in memory.</span>

<span class="sd">        :type new_raster: array-like</span>
<span class="sd">        :type new_extent: array_like</span>
<span class="sd">        :type driver: str</span>
<span class="sd">        :type filename: str</span>

<span class="sd">        :returns new_geo: A new GeoImg with the specified extent and raster.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">driver</span> <span class="o">==</span> <span class="s1">&#39;MEM&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;must specify an output filename with driver </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">driver</span><span class="p">))</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">new_raster</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="n">npix_y</span><span class="p">,</span> <span class="n">npix_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">new_raster</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>  <span class="c1"># give the same raster</span>
            <span class="n">newgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">new_raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_extent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># copy the geoimg and replace the raster with new_raster</span>
            <span class="n">npix_y</span><span class="p">,</span> <span class="n">npix_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_raster</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>

            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_x</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_y</span><span class="p">)</span>
            <span class="n">newgt</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">new_raster</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">new_extent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="c1"># copy the geoimg and replace the raster with new_raster</span>
            <span class="n">npix_y</span><span class="p">,</span> <span class="n">npix_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_raster</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">new_extent</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_x</span><span class="p">)</span>
            <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_y</span><span class="p">)</span>
            <span class="n">newgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_extent</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dx</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">new_extent</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;If new extent is specified, you must also specify the new raster to be used!&#39;</span><span class="p">)</span>
        <span class="n">newGdal</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">npix_x</span><span class="p">,</span> <span class="n">npix_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">datatype</span><span class="p">)</span>
        <span class="n">wa</span> <span class="o">=</span> <span class="n">newGdal</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">new_raster</span><span class="p">)</span>
        <span class="n">sg</span> <span class="o">=</span> <span class="n">newGdal</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">newgt</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">newproj</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newproj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span>

        <span class="n">sp</span> <span class="o">=</span> <span class="n">newGdal</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">newproj</span><span class="p">)</span>
        <span class="n">md</span> <span class="o">=</span> <span class="n">newGdal</span><span class="o">.</span><span class="n">SetMetadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">newGdal</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">wa</span><span class="p">,</span> <span class="n">sg</span><span class="p">,</span> <span class="n">sp</span><span class="p">,</span> <span class="n">md</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">GeoImg</span><span class="p">(</span><span class="n">newGdal</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># make sure to apply mask</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_raster</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="n">new_raster</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">out</span><span class="o">.</span><span class="n">mask</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">out</span></div>

    <span class="c1"># return X,Y grids of coordinates for each pixel    </span>
<div class="viewcode-block" id="GeoImg.xy"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.xy">[docs]</a>    <span class="k">def</span> <span class="nf">xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;corner&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get x,y coordinates of all pixels in the GeoImg.</span>

<span class="sd">        :param ctype: coordinate type. If &#39;corner&#39;, returns corner coordinates of pixels.</span>
<span class="sd">            If &#39;center&#39;, returns center coordinates. Default is corner.</span>
<span class="sd">        :param grid: Return gridded coordinates. Default is True.</span>
<span class="sd">        :type ctype: str</span>
<span class="sd">        :type grid: bool</span>
<span class="sd">        :returns x,y: numpy arrays corresponding to the x,y coordinates of each pixel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">ctype</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;corner&#39;</span><span class="p">,</span> <span class="s1">&#39;center&#39;</span><span class="p">],</span> <span class="s2">&quot;ctype is not one of &#39;corner&#39;, &#39;center&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ctype</span><span class="p">)</span>
        
        <span class="n">xx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">yy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">ctype</span> <span class="o">==</span> <span class="s1">&#39;center&#39;</span><span class="p">:</span>
            <span class="n">xx</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># shift by half a pixel</span>
            <span class="n">yy</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">grid</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">xx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">yy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># drop the last element</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">xx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">yy</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>

<div class="viewcode-block" id="GeoImg.reproject"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.reproject">[docs]</a>    <span class="k">def</span> <span class="nf">reproject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dst_raster</span><span class="p">,</span> <span class="n">driver</span><span class="o">=</span><span class="s1">&#39;MEM&#39;</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GRA_Bilinear</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reproject the GeoImg to the same extent and coordinate system as another GeoImg.</span>

<span class="sd">        :param dst_raster: GeoImg to project given raster to.</span>
<span class="sd">        :param driver: gdal driver to use to create the new GeoImg. Default is &#39;MEM&#39; (in-memory).</span>
<span class="sd">            See gdal docs for more options. If a different driver is used, filename must</span>
<span class="sd">            also be specified.</span>
<span class="sd">        :param filename: Filename corresponding to the new image, if not created in memory.</span>
<span class="sd">        :param method: gdal resampling algorithm to use. Default is GRA_Bilinear.</span>
<span class="sd">            Other options include: GRA_Average, GRA_Cubic, GRA_CubicSpline, GRA_NearestNeighbour.</span>
<span class="sd">            See gdal docs for more options and details.</span>
<span class="sd">        :type dst_raster: GeoImg</span>
<span class="sd">        :type driver: str</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        :type method: gdal_GRA</span>
<span class="sd">        :returns new_geo: reprojected GeoImg.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="n">driver</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">driver</span> <span class="o">==</span> <span class="s1">&#39;MEM&#39;</span><span class="p">:</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
        <span class="k">elif</span> <span class="n">driver</span> <span class="o">==</span> <span class="s1">&#39;GTiff&#39;</span> <span class="ow">and</span> <span class="n">filename</span> <span class="o">==</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;must specify an output filename&#39;</span><span class="p">)</span>

        <span class="n">dest</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">dst_raster</span><span class="o">.</span><span class="n">npix_x</span><span class="p">,</span> <span class="n">dst_raster</span><span class="o">.</span><span class="n">npix_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">dst_raster</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">dst_raster</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
        <span class="c1"># copy the metadata of the current GeoImg to the new GeoImg</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">SetMetadata</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetMetadata</span><span class="p">())</span>
        <span class="k">if</span> <span class="n">dst_raster</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="n">dst_raster</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="n">dst_raster</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">Fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">gdal</span><span class="o">.</span><span class="n">ReprojectImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> <span class="n">dst_raster</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>

        <span class="n">out</span> <span class="o">=</span> <span class="n">GeoImg</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">out</span><span class="o">.</span><span class="n">isfloat</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="n">out</span><span class="o">.</span><span class="n">NDV</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="n">out</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">out</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="n">out</span><span class="o">.</span><span class="n">NDV</span><span class="p">,</span> <span class="n">out</span><span class="o">.</span><span class="n">img</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="GeoImg.shift"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.shift">[docs]</a>    <span class="k">def</span> <span class="nf">shift</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xshift</span><span class="p">,</span> <span class="n">yshift</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Shift the GeoImg in space by a given x,y offset.</span>
<span class="sd">        </span>
<span class="sd">        :param xshift: x offset to shift GeoImg by.</span>
<span class="sd">        :param yshift: y offset to shift GeoImg by.</span>
<span class="sd">        :type xshift: float</span>
<span class="sd">        :type yshift: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">gtl</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
        <span class="n">gtl</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">xshift</span>
        <span class="n">gtl</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+=</span> <span class="n">yshift</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gt</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">gtl</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xmax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gt</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">]</span></div>

<div class="viewcode-block" id="GeoImg.ij2xy"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.ij2xy">[docs]</a>    <span class="k">def</span> <span class="nf">ij2xy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ij</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return x,y coordinates for a given row, column index pair.</span>
<span class="sd">        </span>
<span class="sd">        :param ij: row (i) and column (j) index of pixel.</span>
<span class="sd">        :type ij: float</span>

<span class="sd">        :returns xy: x,y coordinates of i,j in the GeoImg&#39;s spatial reference system.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="p">((</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">((</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span></div>

<div class="viewcode-block" id="GeoImg.xy2ij"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.xy2ij">[docs]</a>    <span class="k">def</span> <span class="nf">xy2ij</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return row, column indices for a given x,y coordinate pair.</span>
<span class="sd">        </span>
<span class="sd">        :param xy: x, y coordinates in the GeoImg&#39;s spatial reference system.</span>
<span class="sd">        :type xy: float</span>

<span class="sd">        :returns ij: i,j indices of x,y in the image.</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">xy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span>  <span class="c1"># if python started at 1, + 0.5</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">UTMtfm</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.5</span>  <span class="c1"># if python started at 1, + 0.5</span>

        <span class="k">return</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span></div>

<div class="viewcode-block" id="GeoImg.is_rotated"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.is_rotated">[docs]</a>    <span class="k">def</span> <span class="nf">is_rotated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Determine whether GeoImg is rotated with respect to North.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># if we have multiple bands, find the smallest index</span>
            <span class="c1"># and sum along that (i.e., collapse the bands into one)</span>
            <span class="n">bnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">tmpimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>
            <span class="c1"># but, we want to make sure we don&#39;t mess up non-nan nodata</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">):</span>
                <span class="n">tmpimg</span><span class="p">[</span><span class="n">tmpimg</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">testband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tmpimg</span><span class="p">,</span> <span class="n">bnum</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">testband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">testband</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">goodinds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">testband</span><span class="p">))</span>
        <span class="n">uli</span> <span class="o">=</span> <span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">ulj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">uli</span><span class="p">])</span>
        <span class="n">llj</span> <span class="o">=</span> <span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>
        <span class="k">return</span> <span class="o">~</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">llj</span><span class="o">-</span><span class="n">ulj</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.02</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.find_corners"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.find_corners">[docs]</a>    <span class="k">def</span> <span class="nf">find_corners</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;ij&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find corner coordinates of valid image area.</span>
<span class="sd">        </span>
<span class="sd">        :param nodata: nodata value to use. Default is numpy.nan</span>
<span class="sd">        :param mode: Type of coordinates to return. Options are &#39;ij&#39;, row/column index,</span>
<span class="sd">            or &#39;xy&#39;, x,y coordinate. Default is &#39;ij&#39;.</span>
<span class="sd">        :type nodata: numeric</span>
<span class="sd">        :type mode: str</span>

<span class="sd">        :returns corners: Array corresponding to the corner coordinates, estimated from the convex hull</span>
<span class="sd">            of the valid data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;ij&#39;</span><span class="p">,</span> <span class="s1">&#39;xy&#39;</span><span class="p">],</span> <span class="s2">&quot;mode is not one of &#39;ij&#39;, &#39;xy&#39;: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
        
        <span class="c1"># if we have more than one band, have to pick one or merge them.</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="c1"># if we have multiple bands, find the smallest index</span>
            <span class="c1"># and sum along that (i.e., collapse the bands into one)</span>
            <span class="n">bnum</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="n">tmpimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>
            <span class="c1"># but, we want to make sure we don&#39;t mess up non-nan nodata</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">nodata</span><span class="p">):</span>
                <span class="n">tmpimg</span><span class="p">[</span><span class="n">tmpimg</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="n">testband</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tmpimg</span><span class="p">,</span> <span class="n">bnum</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">testband</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span>
        <span class="c1"># now we actually get the good indices</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">nodata</span><span class="p">):</span>
            <span class="n">goodinds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">testband</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goodinds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">testband</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">))</span>

        <span class="n">goodpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="n">hull</span> <span class="o">=</span> <span class="n">ConvexHull</span><span class="p">(</span><span class="n">goodpoints</span><span class="p">)</span>

        <span class="n">iverts</span> <span class="o">=</span> <span class="n">goodpoints</span><span class="p">[</span><span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">jverts</span> <span class="o">=</span> <span class="n">goodpoints</span><span class="p">[</span><span class="n">hull</span><span class="o">.</span><span class="n">vertices</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">corners</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">iverts</span><span class="p">,</span> <span class="n">jverts</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;xy&#39;</span><span class="p">:</span>
            <span class="n">xycorners</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">ij2xy</span><span class="p">(</span><span class="n">corner</span><span class="p">)</span> <span class="k">for</span> <span class="n">corner</span> <span class="ow">in</span> <span class="n">corners</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xycorners</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">corners</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.find_valid_bbox"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.find_valid_bbox">[docs]</a>    <span class="k">def</span> <span class="nf">find_valid_bbox</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find bounding box for valid data.</span>

<span class="sd">        :param nodata: nodata value to use for the image. Default is numpy.nan</span>
<span class="sd">        :type nodata: numeric</span>
<span class="sd">            </span>
<span class="sd">        :returns bbox: xmin, xmax, ymin, ymax of valid image area.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">nodata</span><span class="p">):</span>
            <span class="n">goodinds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">goodinds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">))</span>

        <span class="c1"># get the max, min of x,y that are valid.</span>
        <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ij2xy</span><span class="p">((</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()))</span>
        <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ij2xy</span><span class="p">((</span><span class="n">goodinds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">goodinds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>

        <span class="k">return</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">)]</span></div>

<div class="viewcode-block" id="GeoImg.set_NDV"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.set_NDV">[docs]</a>    <span class="k">def</span> <span class="nf">set_NDV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">NDV</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Set nodata value to given value</span>

<span class="sd">        :param NDV: value to set to nodata.</span>
<span class="sd">        :type NDV: numeric</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="o">=</span> <span class="n">NDV</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="n">NDV</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span></div>

<div class="viewcode-block" id="GeoImg.subimages"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.subimages">[docs]</a>    <span class="k">def</span> <span class="nf">subimages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">Ny</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sBuffer</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Split the GeoImg into sub-images.</span>
<span class="sd">        </span>
<span class="sd">        :param N: number of column cells to split the image into.</span>
<span class="sd">        :param Ny: number of row cells to split image into. Default is same as N.</span>
<span class="sd">        :param sBuffer: number of pixels to overlap subimages by. Default is 0.</span>

<span class="sd">        :type N: int</span>
<span class="sd">        :type Ny: int</span>
<span class="sd">        :type sBuffer: int</span>

<span class="sd">        :returns sub_images: list of GeoImg tiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">Nx</span> <span class="o">=</span> <span class="n">N</span>
        <span class="k">if</span> <span class="n">Ny</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">Ny</span> <span class="o">=</span> <span class="n">N</span>

        <span class="n">new_width</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Nx</span><span class="p">)))</span>
        <span class="n">new_height</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">Ny</span><span class="p">)))</span>

        <span class="n">simages</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nx</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Ny</span><span class="p">):</span>
                <span class="n">lind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">j</span><span class="o">*</span><span class="n">new_width</span><span class="o">-</span><span class="n">sBuffer</span><span class="p">)</span>
                <span class="n">rind</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span><span class="p">,</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">new_width</span> <span class="o">+</span> <span class="n">sBuffer</span><span class="p">)</span>
                <span class="n">tind</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">new_height</span><span class="o">-</span><span class="n">sBuffer</span><span class="p">)</span>
                <span class="n">bind</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span><span class="p">,</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">new_height</span> <span class="o">+</span> <span class="n">sBuffer</span><span class="p">)</span>

                <span class="n">imgN</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">tind</span><span class="p">:</span><span class="n">bind</span><span class="p">,</span> <span class="n">lind</span><span class="p">:</span><span class="n">rind</span><span class="p">]</span>
                <span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ij2xy</span><span class="p">((</span><span class="n">bind</span><span class="p">,</span> <span class="n">lind</span><span class="p">))</span>
                <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ij2xy</span><span class="p">((</span><span class="n">tind</span><span class="p">,</span> <span class="n">rind</span><span class="p">))</span>
                <span class="n">extN</span> <span class="o">=</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="p">]</span>
                <span class="n">newGimg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">new_raster</span><span class="o">=</span><span class="n">imgN</span><span class="p">,</span> <span class="n">new_extent</span><span class="o">=</span><span class="n">extN</span><span class="p">)</span>
                <span class="n">simages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newGimg</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">simages</span></div>

<div class="viewcode-block" id="GeoImg.crop_to_extent"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.crop_to_extent">[docs]</a>    <span class="k">def</span> <span class="nf">crop_to_extent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">extent</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crop image to given extent.</span>
<span class="sd">        </span>
<span class="sd">        :param extent: Extent to which image should be cropped. If extent is a matplotlib figure handle, the image</span>
<span class="sd">            extent is taken from the x and y limits of the current figure axes. If extent is array-like, </span>
<span class="sd">            it is assumed to be [xmin, xmax, ymin, ymax]</span>
<span class="sd">        :type extent: matplotlib.figure.Figure or array-like</span>
<span class="sd">        :returns cropped_img: new GeoImg object resampled to the given image extent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">extent</span><span class="p">,</span> <span class="n">plt</span><span class="o">.</span><span class="n">Figure</span><span class="p">):</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
            <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extent</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">extent</span>

        <span class="n">npix_x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="p">)))</span>
        <span class="n">npix_y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="p">)))</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmax</span> <span class="o">-</span> <span class="n">xmin</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_x</span><span class="p">)</span>
        <span class="n">dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">ymin</span> <span class="o">-</span> <span class="n">ymax</span><span class="p">)</span> <span class="o">/</span> <span class="nb">float</span><span class="p">(</span><span class="n">npix_y</span><span class="p">)</span>

        <span class="n">drv</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;MEM&#39;</span><span class="p">)</span>
        <span class="n">dest</span> <span class="o">=</span> <span class="n">drv</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">npix_x</span><span class="p">,</span> <span class="n">npix_y</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">)</span>
        <span class="n">newgt</span> <span class="o">=</span> <span class="p">(</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">ymax</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="n">dest</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">newgt</span><span class="p">)</span>
        <span class="n">gdal</span><span class="o">.</span><span class="n">ReprojectImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="p">,</span> <span class="n">dest</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proj</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GRA_Bilinear</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">NDV</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">dest</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">NDV</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">GeoImg</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.overlay"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.overlay">[docs]</a>    <span class="k">def</span> <span class="nf">overlay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">sfact</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">showfig</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Overlay raster on top of GeoImg.</span>
<span class="sd">        </span>
<span class="sd">        :param raster: raster to display on top of the GeoImg.</span>
<span class="sd">        :param extent: Spatial of the raster. If not set, assumed to be same as the extent of the GeoImg.</span>
<span class="sd">            Given as xmin, xmax, ymin, ymax.</span>
<span class="sd">        :param vmin: minimum color value for the raster. Default is 0.</span>
<span class="sd">        :param vmax: maximum color value for the raster. Default is 10.</span>
<span class="sd">        :param sfact: Factor by which to reduce the number of points plotted.</span>
<span class="sd">            Default is 1 (i.e., all points are plotted).</span>
<span class="sd">        :param showfig: Open the figure window. Default is True.</span>
<span class="sd">        :param alpha: Alpha value to use for the overlay. Default is 0.25</span>
<span class="sd">        :param cmap: matplotlib.pyplot colormap to use for the image. Default is jet.</span>
<span class="sd">        :type raster: array-like</span>
<span class="sd">        :type extent: array-like</span>
<span class="sd">        :type vmin: float</span>
<span class="sd">        :type vmax: float</span>
<span class="sd">        :type sfact: int</span>
<span class="sd">        :type showfig: bool</span>
<span class="sd">        :type alpha: float</span>
<span class="sd">        :type cmap: str</span>

<span class="sd">        :returns fig: Handle pointing to the matplotlib Figure created (or passed to display).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">(</span><span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">,</span> <span class="n">sfact</span><span class="o">=</span><span class="n">sfact</span><span class="p">,</span> <span class="n">showfig</span><span class="o">=</span><span class="n">showfig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">showfig</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">ion</span><span class="p">()</span>

        <span class="n">oimg</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">vmin</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="n">vmax</span><span class="p">,</span> <span class="n">extent</span><span class="o">=</span><span class="n">extent</span><span class="p">)</span>

        <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>

        <span class="n">divider</span> <span class="o">=</span> <span class="n">make_axes_locatable</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">cax</span> <span class="o">=</span> <span class="n">divider</span><span class="o">.</span><span class="n">append_axes</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;5%&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">oimg</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cax</span><span class="p">)</span>

<span class="c1">#        plt.show()</span>

        <span class="k">return</span> <span class="n">fig</span></div>

<div class="viewcode-block" id="GeoImg.mask"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.mask">[docs]</a>    <span class="k">def</span> <span class="nf">mask</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">mask_value</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mask image values.</span>

<span class="sd">        :param mask: Array of same size as self.img corresponding to values that should be masked.</span>
<span class="sd">        :param mask_value: Value within mask to mask. If True, masks image where mask is True. If numeric, masks image</span>
<span class="sd">            where mask == mask_value.</span>
<span class="sd">        :type mask: array-like</span>
<span class="sd">        :type mask_value: bool or numeric</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mask_value</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">mask_value</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="n">mask</span> <span class="o">==</span> <span class="n">mask_value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.unmask"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.unmask">[docs]</a>    <span class="k">def</span> <span class="nf">unmask</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Remove mask from image. If mask is not set, has no effect.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_array</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">data</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="GeoImg.random_points"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.random_points">[docs]</a>    <span class="k">def</span> <span class="nf">random_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Npts</span><span class="p">,</span> <span class="n">edge_buffer</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Generate a random sample of points within the image.</span>
<span class="sd">        </span>
<span class="sd">        :param Npts: number of random points to sample.</span>
<span class="sd">        :param edge_buffer: Optional buffer around edge of image, where pixels shouldn&#39;t be sampled. Default is zero.</span>
<span class="sd">        :type Npts: int</span>
<span class="sd">        :type edge_buffer: int</span>
<span class="sd">        :returns rand_pts: array of N random points from within the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># first, if we don&#39;t have an edge buffer and don&#39;t have a mask, everything is easy.</span>
        <span class="k">if</span> <span class="n">edge_buffer</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>  <span class="c1"># a list of indices</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                <span class="n">goodinds</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">goodinds</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">mask</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span>
                                   <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">goodinds</span><span class="p">),</span> <span class="n">Npts</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="n">edge_buffer</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">tmp_img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">edge_buffer</span><span class="p">:</span><span class="o">-</span><span class="n">edge_buffer</span><span class="p">,</span> <span class="n">edge_buffer</span><span class="p">:</span><span class="o">-</span><span class="n">edge_buffer</span><span class="p">]</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">tmp_img</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
                <span class="n">tmp_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">mask</span><span class="p">[</span><span class="n">edge_buffer</span><span class="p">:</span><span class="o">-</span><span class="n">edge_buffer</span><span class="p">,</span> <span class="n">edge_buffer</span><span class="p">:</span><span class="o">-</span><span class="n">edge_buffer</span><span class="p">]</span>
                <span class="n">goodinds</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">invert</span><span class="p">(</span><span class="n">tmp_mask</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tmp_img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)))]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">goodinds</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isfinite</span><span class="p">(</span><span class="n">tmp_img</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))]</span>
            <span class="c1"># return a random list as above, but remember to shift everything by the edge buffer.</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">tmp_img</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">+</span><span class="n">edge_buffer</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">goodinds</span><span class="p">),</span> <span class="n">Npts</span><span class="p">)])</span></div>

<div class="viewcode-block" id="GeoImg.raster_points"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.raster_points">[docs]</a>    <span class="k">def</span> <span class="nf">raster_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">nsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate raster values at a given point, or sets of points. </span>

<span class="sd">        :param pts: Point(s) at which to interpolate raster value. If points fall outside</span>
<span class="sd">            of image, value returned is nan.&#39;</span>
<span class="sd">        :param nsize: Number of neighboring points to include in the interpolation. Default is 1.</span>
<span class="sd">        :param mode: One of &#39;linear&#39;, &#39;cubic&#39;, or &#39;quintic&#39;. Determines what type of spline is</span>
<span class="sd">            used to interpolate the raster value at each point. For more information, see</span>
<span class="sd">            scipy.interpolate.interp2d. Default is linear.</span>
<span class="sd">        :type pts: array-like</span>
<span class="sd">        :type nsize: int</span>
<span class="sd">        :type mode: str</span>

<span class="sd">        :returns rpts: Array of raster value(s) for the given points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;quintic&#39;</span><span class="p">],</span><span class="s2">&quot;mode must be linear, cubic, or quintic.&quot;</span>

        <span class="n">rpts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># if we&#39;re given only one point, corresponding array</span>
        <span class="c1"># should have a size of two. in which case, we wrap it in a list.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">pts</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_area</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_point</span><span class="p">()</span>            
            
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">:</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2ij</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outside_image</span><span class="p">(</span><span class="n">ij</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
                <span class="n">rpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># print(&quot;not outside!&quot;)</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">z</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">zint</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()),</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">pt</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">zint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
                <span class="n">rpts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">zint</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rpts</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.raster_points2"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.raster_points2">[docs]</a>    <span class="k">def</span> <span class="nf">raster_points2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pts</span><span class="p">,</span> <span class="n">nsize</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Interpolate raster values at a given point, or sets of points using multiprocessing for speed.</span>

<span class="sd">        :param pts: Point(s) at which to interpolate raster value. If points fall outside</span>
<span class="sd">            of image, value returned is nan.&#39;</span>
<span class="sd">        :param nsize: Number of neighboring points to include in the interpolation. Default is 1.</span>
<span class="sd">        :param mode: One of &#39;linear&#39;, &#39;cubic&#39;, or &#39;quintic&#39;. Determines what type of spline is</span>
<span class="sd">            used to interpolate the raster value at each point. For more information, see </span>
<span class="sd">            scipy.interpolate.interp2d.</span>
<span class="sd">        :type pts: array-like</span>
<span class="sd">        :type nsize: int</span>
<span class="sd">        :type mode: str</span>

<span class="sd">        :returns rpts: Array of raster value(s) for the given points.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">mode</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="s1">&#39;quintic&#39;</span><span class="p">],</span><span class="s2">&quot;mode must be linear, cubic, or quintic.&quot;</span>
        <span class="c1"># if we&#39;re given only one point, corresponding array</span>
        <span class="c1"># should have a size of two. in which case, we wrap it in a list.</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">pts</span> <span class="o">=</span> <span class="p">[</span><span class="n">pts</span><span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_area</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">to_point</span><span class="p">()</span>            
            
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy</span><span class="p">(</span><span class="n">ctype</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">getgrids</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
            <span class="n">myimg</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">nsize</span><span class="p">,</span> <span class="n">mode</span> <span class="o">=</span> <span class="n">a</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="n">myimg</span><span class="o">.</span><span class="n">xy2ij</span><span class="p">(</span><span class="n">pt</span><span class="p">)</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="p">))</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">xx</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">yy</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">z</span> <span class="o">=</span> <span class="n">myimg</span><span class="o">.</span><span class="n">img</span><span class="p">[</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">nsize</span><span class="p">:</span><span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">nsize</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">pt</span><span class="p">,</span> <span class="n">ij</span><span class="p">,</span> <span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">mode</span><span class="p">)</span>

        <span class="n">myins</span> <span class="o">=</span> <span class="p">[</span><span class="n">getgrids</span><span class="p">((</span><span class="bp">self</span><span class="p">,</span> <span class="n">pt</span><span class="p">,</span> <span class="n">nsize</span><span class="p">,</span> <span class="n">mode</span><span class="p">))</span> <span class="k">for</span> <span class="n">pt</span> <span class="ow">in</span> <span class="n">pts</span><span class="p">]</span>
        <span class="c1"># print(&quot;half way&quot;)</span>
        <span class="c1"># myout = np.asarray([int_pts(myin,nsize,mode) for myin in myins])</span>
        <span class="n">pool</span> <span class="o">=</span> <span class="n">Pool</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>
        <span class="c1"># return np.asarray([int_pts(pt,self,nsize,mode) for pt in pts])</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">pool</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">int_pts</span><span class="p">,</span><span class="n">myins</span><span class="p">))</span></div>

<div class="viewcode-block" id="GeoImg.outside_image"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.outside_image">[docs]</a>    <span class="k">def</span> <span class="nf">outside_image</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ij</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check whether a given point falls outside of the image.</span>
<span class="sd">        </span>
<span class="sd">        :param ij: Indices (or coordinates) of point to check.</span>
<span class="sd">        :param index: Interpret ij as raster indices (default is True). If False, assumes ij is coordinates.</span>
<span class="sd">        :type ij: array-like</span>
<span class="sd">        :type index: bool</span>

<span class="sd">        :returns is_outside: True if ij is outside of the image.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">index</span><span class="p">:</span>
            <span class="n">ij</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy2ij</span><span class="p">(</span><span class="n">ij</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">ij</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="n">ij</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_y</span> <span class="ow">or</span> <span class="n">ij</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">npix_x</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="GeoImg.std"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns standard deviation (ignoring NaNs) of the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.mean"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns mean (ignoring NaNs) of the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.median"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.median">[docs]</a>    <span class="k">def</span> <span class="nf">median</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns median (ignoring NaNs) of the image.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">img</span><span class="p">)</span></div>

<div class="viewcode-block" id="GeoImg.to_point"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.to_point">[docs]</a>    <span class="k">def</span> <span class="nf">to_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change pixel location from corner (&#39;Area&#39;) to center (&#39;Point&#39;). Shifts raster by half pixel in the +x, -y direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">==</span> <span class="s1">&#39;Area&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">=</span> <span class="s1">&#39;Point&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">SetMetadataItem</span><span class="p">(</span><span class="s1">&#39;AREA_OR_POINT&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="GeoImg.to_area"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.to_area">[docs]</a>    <span class="k">def</span> <span class="nf">to_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Change pixel location from center (&#39;Point&#39;) to corner (&#39;Area&#39;). Shifts raster by half pixel in the -x, +y direction.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">==</span> <span class="s1">&#39;Point&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">=</span> <span class="s1">&#39;Area&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gd</span><span class="o">.</span><span class="n">SetMetadataItem</span><span class="p">(</span><span class="s1">&#39;AREA_OR_POINT&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dx</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span></div>

<div class="viewcode-block" id="GeoImg.is_point"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.is_point">[docs]</a>    <span class="k">def</span> <span class="nf">is_point</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if pixel coordinates correspond to pixel centers.</span>

<span class="sd">        :returns is_point: True if pixel coordinates correspond to pixel centers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">==</span> <span class="s1">&#39;Point&#39;</span></div>

<div class="viewcode-block" id="GeoImg.is_area"><a class="viewcode-back" href="../../modules/pybob.GeoImg.html#pybob.GeoImg.GeoImg.is_area">[docs]</a>    <span class="k">def</span> <span class="nf">is_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Check if pixel coordinates correspond to pixel corners.</span>

<span class="sd">        :returns is_area: True if pixel coordinates correspond to pixel corners.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">px_loc</span> <span class="o">==</span> <span class="s1">&#39;Area&#39;</span></div></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Robert McNabb

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>